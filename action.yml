name: 'Test Github Action'

description: 'Test Github Action Description'

inputs:
  token:
    description: 'Github token'
    required: true

runs:
  using: "composite"
  steps:  
    - run: chmod +x gradlew
      shell: bash

    - name: Run testGradleTask
      uses: gradle/gradle-build-action@v2
      with:
        arguments: testGradleTask
      env:
        USERNAME: ${{ github.actor }}
        TOKEN: ${{ inputs.token }}

    - name: Commit generated tests # only if there are changes
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add -A build/generated/test
        git diff --quiet HEAD build/generated/test || git commit -m "[UTBot]: Add generated tests"
      shell: bash

    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ inputs.token }}
        branch: ${{ github.ref }}

    - name: Upload SARIF file
      uses: github/codeql-action/upload-sarif@v1
      with:
        sarif_file: build/generated/utbot.sarif
